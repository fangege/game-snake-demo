# 坦克大战 - 客户端预测演示

这是一个展示**客户端预测 + 服务端校正**网络同步技术的坦克大战游戏演示。

## 快速开始

### 1. 安装依赖

```bash
npm install
```

### 2. 启动服务器

```bash
node server/tank_battle/app.js
```

### 3. 访问游戏

打开浏览器访问: `http://localhost:3003/tank_battle`

## 游戏特性

### 🎮 游戏玩法
- 双人实时坦克对战
- 移动、旋转、射击机制
- 血量系统和得分统计
- 碰撞检测和物理反馈

### 🌐 网络同步技术
- **客户端预测**: 输入立即响应，无延迟感
- **服务端校正**: 权威状态校正，确保公平性
- **延迟补偿**: 智能处理网络延迟
- **反作弊系统**: 输入验证和异常检测

### 🔧 调试工具
- 实时网络延迟监控
- FPS和性能统计
- 预测校正次数统计
- 服务端时间同步状态

## 控制说明

- **W/S**: 前进/后退
- **A/D**: 左转/右转
- **空格**: 射击

## 技术架构

```
客户端预测流程:
输入 → 立即预测 → 发送服务端 → 接收校正 → 状态同步
  ↓        ↓          ↓         ↓        ↓
本地响应  预测计算   网络传输   权威验证  平滑校正
```

### 核心组件

- **app.js**: Express服务器和WebSocket处理
- **game_engine.js**: 游戏逻辑引擎和反作弊系统
- **physics.js**: 确定性物理计算引擎
- **client_prediction.ejs**: 客户端预测实现

## 配置参数

```javascript
const CONFIG = {
    TICK_RATE: 60,        // 服务端更新频率
    BROADCAST_RATE: 20,   // 状态广播频率
    TANK_SPEED: 2,        // 坦克移动速度
    BULLET_SPEED: 5,      // 子弹速度
    FIRE_COOLDOWN: 500,   // 射击冷却时间(ms)
    MAX_BULLETS: 3        // 最大子弹数
};
```

## 性能监控

游戏提供实时性能监控：

- **延迟**: 客户端到服务端的网络延迟
- **FPS**: 客户端渲染帧率
- **校正次数**: 预测错误校正统计
- **输入序列**: 输入处理状态
- **时间偏移**: 客户端与服务端时间差

## 与其他同步技术对比

| 技术 | 延迟感知 | 实现复杂度 | 适用场景 |
|------|----------|------------|----------|
| 状态同步 | 高 | 低 | 回合制游戏 |
| 帧同步 | 中 | 中 | RTS游戏 |
| 客户端预测 | 低 | 高 | FPS/动作游戏 |

## 开发说明

### 添加新功能

1. 在`game_engine.js`中添加服务端逻辑
2. 在`physics.js`中添加物理计算
3. 在客户端添加预测逻辑
4. 更新网络协议消息格式

### 调试技巧

1. 使用浏览器开发者工具查看WebSocket消息
2. 观察调试面板中的性能指标
3. 检查服务端控制台的反作弊日志
4. 使用网络延迟模拟测试同步效果

## 扩展建议

- 添加更多玩家支持
- 实现道具和技能系统
- 添加地图和障碍物
- 支持移动端操作
- 实现观战模式

## 许可证

MIT License